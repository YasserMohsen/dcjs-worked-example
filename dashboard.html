<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>

<!-- pull in D3, Crossfilter, and dc.js libraries -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js' type='text/javascript'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js' type='text/javascript'></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.0-dev/dc.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.0-dev/dc.css"/>
</head>

<body>

<!-- create a table to host the dataTable
     new in step 4: added bootstrap classes
     to make the table look nicer -->
<table class="dc-data-table table table-hover"></table>

<script type='text/javascript'>
// this is the variable that holds the data table
var nasdaqTable = dc.dataTable('.dc-data-table');

// load the data in from the CSV with d3
d3.csv('ndx.csv', function (data) {
    // coerce the data into the correct format (see Step 2)
    var dateFormat = d3.time.format('%m/%d/%Y');
    var numberFormat = d3.format('.2f');

    data.forEach(function (d) {
        d.dd = dateFormat.parse(d.date);
        d.close = +d.close; // coerce to number
        d.open = +d.open;
        d.change = +d.change;
        d.volume = +d.volume
    });

    // load the data into CrossFilter
    var ndx = crossfilter(data);

    // Create a data dimension
    var dateDimension = ndx.dimension(function (d) {
        return d.dd;
    });

    // create the dataTable
    nasdaqTable
        .dimension(dateDimension) // obligatory
        .group(function (d) {
            // obligatory
            return 'All';
        })
        .size(Infinity) // optional, default 25
        .columns([ // obligatory
            'date',
            'open',
            'close',
            {
                label: 'Change', // use this as the column label
                format: function (d) {
                    return numberFormat(d.close - d.open);
                }
            },
            'volume'
        ])
        .sortBy(function (d) {
            // optional
            return d.dd;
        })
        .order(
            // optional
            d3.ascending
        )

    // render all charts (in this case just the datatable)
    dc.renderAll();

});
</script>


</body>

</html>
